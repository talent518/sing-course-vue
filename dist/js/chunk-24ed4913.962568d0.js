(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24ed4913"],{"141d":function(e,t,r){"use strict";var a=r("e3aa"),n=r.n(a);n.a},"43e5":function(e,t,r){"use strict";r("4de4"),r("4160"),r("159b"),r("96cf");var a=r("1da1");t["a"]={data:function(){return{orgId:"",productId:"",uid:"",beginDate:"",endDate:"",orgs:[],products:[],userList:[],valueDate:[],inventoryList:[],type:"",allProCityList:[],provinceList:[],reportList:[]}},methods:{getOrgs:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ApiOther.getOrgs();case 2:r=t.sent,a=e.getTreeList(r,0,[],"orgId"),r=e.flattenOrgs(a),e.orgs=r;case 6:case"end":return t.stop()}}),t)})))()},getProduct:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ApiProduction.getProduct();case 2:e.products=t.sent;case 3:case"end":return t.stop()}}),t)})))()},flattenOrgs:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.forEach((function(e){e.index=a,r.push(e),e.children&&t.flattenOrgs(e.children,r,a+1)})),r},getUsers:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.ApiUser.getSelectUsers(e);case 2:t.userList=r.sent;case 3:case"end":return r.stop()}}),r)})))()},getInventorTypes:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ApiProduction.productPurchaseType();case 2:e.inventoryList=t.sent;case 3:case"end":return t.stop()}}),t)})))()},getAllProvince:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ApiOther.dictProvince();case 2:e.allProCityList=t.sent,e.provinceList=e.getTarget(e.allProCityList);case 4:case"end":return t.stop()}}),t)})))()},getTarget:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.filter((function(e){if(e.parentId===t)return e}))}}}},"7a16":function(e,t,r){"use strict";var a=r("bae7"),n=r.n(a);t["default"]=n.a},"7db0":function(e,t,r){"use strict";var a=r("23e7"),n=r("b727").find,i=r("44d2"),o=r("ae40"),c="find",s=!0,u=o(c);c in[]&&Array(1)[c]((function(){s=!1})),a({target:"Array",proto:!0,forced:s||!u},{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),i(c)},8302:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",[r("el-row",{staticClass:"textLeft m20 el-form100",attrs:{gutter:20}},[r("el-col",{attrs:{span:4}},[r("el-select",{attrs:{placeholder:"请选择组织","value-key":"orgId",clearable:""},model:{value:e.orgId,callback:function(t){e.orgId=t},expression:"orgId"}},e._l(e.orgs,(function(t){return r("el-option",{key:t.orgId,attrs:{label:t.orgName,value:t.orgId}},[e._l(t.index,(function(t){return r("span",{staticClass:"opcaity"},[e._v("13")])})),r("span",[e._v(e._s(t.orgName))])],2)})),1)],1),r("el-col",{attrs:{span:4}},[r("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请选择经销人员","remote-method":e.getUsers,"value-key":"id",clearable:""},model:{value:e.uid,callback:function(t){e.uid=t},expression:"uid"}},e._l(e.userList,(function(e){return r("el-option",{key:e.uid,attrs:{label:e.nickname,value:e.uid}})})),1)],1),r("el-col",{attrs:{span:4}},[r("el-select",{attrs:{placeholder:"请选择商品","value-key":"id",clearable:""},model:{value:e.productId,callback:function(t){e.productId=t},expression:"productId"}},e._l(e.vipProducts,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),r("el-col",{attrs:{span:5}},[r("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.valueDate,callback:function(t){e.valueDate=t},expression:"valueDate"}})],1),r("el-col",{attrs:{span:5}},[r("el-button",{attrs:{type:"primary"},on:{click:e.searchM}},[e._v("查询")]),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:"VipBatchCreate",expression:"'VipBatchCreate'"}],attrs:{type:"success"},on:{click:e.addbatch}},[e._v(" 制作兑换码 ")])],1)],1),r("my-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.data}},[r("el-table-column",{attrs:{label:"经销人员",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("ul",[r("li",[r("span",[e._v("所属组织：")]),r("span",[e._v(e._s(t.row.orgName))])]),r("li",[r("span",[e._v("经销人员：")]),r("span",[e._v(e._s(t.row.nickname))])]),r("li",[r("span",[e._v("身份：")]),r("span",[e._v(e._s(t.row.identityName))])])])]}}])}),e._l(e.columnslist,(function(e){return r("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label}})})),r("el-table-column",{attrs:{label:"兑换码数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-link",{attrs:{type:"primary"},on:{click:function(r){return e.showDetail(t)}}},[e._v(e._s(t.row.actives)+"/"+e._s(t.row.num)+" ")])]}}])}),e._l(e.columnslistX,(function(e){return r("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,width:e.width}})})),r("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.num!==t.row.actives&&1===t.row.status?r("span",{attrs:{type:"text"}},[e._v(e._s(t.row.statusV))]):e._e(),t.row.num!==t.row.actives&&2===t.row.status&&e.userInfo.uid===t.row.uid?r("el-button",{attrs:{type:"text"},on:{click:function(r){return e.downQrCode(t)}}},[e._v(e._s(t.row.statusV)+" ")]):e._e(),t.row.num===t.row.actives?r("el-button",{attrs:{type:"text"}},[e._v("已兑换完毕 ")]):e._e()]}}])})],2),r("el-pagination",{staticClass:"m20",attrs:{background:"",layout:"prev, pager, next,total",total:e.total,"page-size":e.pageSize,"current-page":e.curPage},on:{"current-change":e.currentChange,"update:currentPage":function(t){e.curPage=t},"update:current-page":function(t){e.curPage=t}}}),e.dialogFormVisible?r("el-dialog",{attrs:{title:"制作兑换码",visible:e.dialogFormVisible,"close-on-click-modal":e.clickmodal},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("my-form",{attrs:{rules:e.rules,model:e.model}},[r("el-form-item",{staticClass:"textLeft",attrs:{label:"兑换商品：",prop:"productId1"}},[r("el-select",{attrs:{placeholder:"请选择兑换商品","value-key":"id"},on:{change:e.changeProduct},model:{value:e.model.productId1,callback:function(t){e.$set(e.model,"productId1",t)},expression:"model.productId1"}},e._l(e.vipProducts,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),r("span",{staticClass:"m30L"},[e._v("现有库存："+e._s(e.amount))])],1),r("el-form-item",{staticClass:"textLeft myNumber",attrs:{label:"兑换数量：",prop:"num"}},[r("div",{class:e.$style.myInput},[r("el-input",{attrs:{controls:!1,precision:0,min:1,max:e.maxValue,placeholder:"请选择兑换数量"},model:{value:e.model.num,callback:function(t){e.$set(e.model,"num",t)},expression:"model.num"}})],1),r("span",{staticClass:"m30L"},[e._v("最大兑换数量："+e._s(e.maxValue))])]),r("el-form-item",{attrs:{label:"备注："}},[r("el-input",{attrs:{placeholder:"请输入备注"},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1),r("el-form-item",{staticClass:"textLeft",attrs:{label:""}},[r("el-button",{attrs:{disabled:0==e.maxValue,type:"success"},on:{click:e.save}},[e._v("确定制作 ")])],1)],1)],1):e._e(),e.dialogFormVisible2?r("el-dialog",{attrs:{title:"已使用兑换码",visible:e.dialogFormVisible2,"close-on-click-modal":e.clickmodal},on:{"update:visible":function(t){e.dialogFormVisible2=t}}},[r("el-row",{staticClass:"m20 el-form100",attrs:{gutter:20}},[r("el-col",{staticClass:"textLeft",attrs:{span:10}},[r("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",l:""},on:{change:e.changeDetailDate},model:{value:e.valueDate1,callback:function(t){e.valueDate1=t},expression:"valueDate1"}})],1),r("el-col",{attrs:{span:6}},[r("el-input",{attrs:{placeholder:"请输入卡号"},model:{value:e.cardId,callback:function(t){e.cardId=t},expression:"cardId"}})],1),r("el-col",{attrs:{span:4}},[r("el-button",{attrs:{type:"success"},on:{click:e.searchDetail}},[e._v("查询")])],1)],1),r("my-table",{attrs:{data:e.cardsList}},e._l(e.columnslist1,(function(e){return r("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label}})})),1),r("el-pagination",{attrs:{background:"",layout:"prev, pager, next,total",total:e.total1,"page-size":e.pageSize1,"current-page":e.curPage1},on:{"current-change":e.currentChange1,"update:currentPage":function(t){e.curPage1=t},"update:current-page":function(t){e.curPage1=t}}})],1):e._e()],1)},n=[],i=(r("7db0"),r("4160"),r("b0c0"),r("a9e3"),r("ac1f"),r("5319"),r("159b"),r("96cf"),r("1da1")),o=r("5530"),c=r("ade3"),s=r("bcaf"),u=r("a833"),l=r("43e5"),d=r("2f62"),p={name:"VipBatch",mixins:[s["a"],u["a"],l["a"]],data:function(){var e,t=this,r=function(e,r,a){if(0==r||""==r)return t.model.num=1,void a();"string"===typeof r&&(r=r.replace(/\D/g,""));var n=1*t.maxValue;r*=1,r>n?(t.timer=!0,a(new Error("您输入的值不能超过最大兑换数量")),setTimeout((function(){t.model.num=n}),1e3)):(t.model.num=r,a())};return e={data:[],columnslist:[{prop:"productName",label:"商品名称",width:100},{prop:"price",label:"销售价"}],columnslistX:[{prop:"batchId",label:"批次号",width:100},{prop:"createTime",label:"生成时间",width:160},{prop:"remark",label:"备注"}],dialogFormVisible2:!1,valueDate1:[],columnslist1:[{prop:"cardId",label:"卡号"},{prop:"salt",label:"激活码"},{prop:"orderNO",label:"订单号"},{prop:"updateTime",label:"激活时间",width:200}],vipProducts:[],status:[],amount:"",model:{productId1:"",num:1},rules:{productId1:[{required:!0,message:"选择兑换商品",trigger:["blur","change"]}],num:[{required:!0,message:"请输入兑换数量",trigger:["blur","change"]},{validator:r,trigger:"change"}]},remark:"",maxVipBatch:0,pageSize:5,total1:1,pageSize1:5,cardsList:[]},Object(c["a"])(e,"valueDate1",[]),Object(c["a"])(e,"beginDate1",""),Object(c["a"])(e,"endDate1",""),Object(c["a"])(e,"cardId",""),Object(c["a"])(e,"curPage1",1),e},computed:Object(o["a"])({},Object(d["c"])("user",{userInfo:"userInfo"}),{maxValue:function(){return Math.min(this.amount,this.maxVipBatch)}}),methods:{open1:function(){this.dialogFormVisible2=!0},close1:function(){this.dialogFormVisible2=!1},resetData1:function(){this.curPage1=1,this.valueDate1=[],this.beginDate1="",this.endDate1="",this.cardId=""},changeDetailDate:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.valueDate1&&e.valueDate1.length?(e.beginDate1=e.dayjs(e.valueDate1[0]).format("YYYY-MM-DD"),e.endDate1=e.dayjs(e.valueDate1[1]).format("YYYY-MM-DD")):(e.beginDate1="",e.endDate1="");case 1:case"end":return t.stop()}}),t)})))()},getVipCardsData:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={cardId:e.cardId,beginDate:e.beginDate1,endDate:e.endDate1,pageSize:e.pageSize1,curPage:e.curPage1,id:e.batchId},t.next=3,e.ApiProduction.vipBatchCards(r);case 3:a=t.sent,e.cardsList=a.list,e.total1=a.rowCount;case 6:case"end":return t.stop()}}),t)})))()},searchDetail:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getVipCardsData();case 1:case"end":return t.stop()}}),t)})))()},showDetail:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=e.row,t.resetData1(),t.open1(),t.batchId=a.batchId,t.getVipCardsData();case 5:case"end":return r.stop()}}),r)})))()},save:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ApiProduction.vipBatchProd({productId:e.model.productId1,num:e.model.num,remark:e.remark});case 2:r=t.sent,r===e.saveSuccess&&(e.close(),e.refleshData());case 4:case"end":return t.stop()}}),t)})))()},refleshData:function(){this.getTableList()},changeProduct:function(){var e=this,t=this.vipProducts.find((function(t){return t.id===e.model.productId1}));this.amount=t.amount},downQrCode:function(e){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var a,n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=e.row,r.next=3,t.ApiProduction.getVipQrCode(a.batchId);case 3:n=r.sent,location.href=n;case 5:case"end":return r.stop()}}),r)})))()},resetData:function(){this.model={productId1:"",num:1},this.amount=0,this.getBathSetting(),this.remark=""},addbatch:function(){this.resetData(),this.open()},searchM:function(){this.getTableList()},currentChange:function(){this.searchM()},currentChange1:function(){this.getVipCardsData()},getVipBatchPro:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ApiProduction.getVipBatchPro();case 2:e.vipProducts=t.sent;case 3:case"end":return t.stop()}}),t)})))()},getVipBatchStatus:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ApiProduction.getVipBatchStatus();case 2:e.status=t.sent;case 3:case"end":return t.stop()}}),t)})))()},getBathSetting:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.ApiProduction.getBathSetting();case 2:r=t.sent,e.maxVipBatch=Number(r.maxVipBatch);case 4:case"end":return t.stop()}}),t)})))()},getTableList:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.openLoading(),e.valueDate&&e.valueDate.length?(e.beginDate=e.dayjs(e.valueDate[0]).format("YYYY-MM-DD"),e.endDate=e.dayjs(e.valueDate[1]).format("YYYY-MM-DD")):(e.beginDate="",e.endDate=""),r={orgId:e.orgId,productId:e.productId,uid:e.uid,beginDate:e.beginDate,endDate:e.endDate,curPage:e.curPage,pageSize:e.pageSize},t.next=5,e.ApiProduction.getVipBatch(r);case 5:a=t.sent,a.list.forEach((function(t){e.vipProducts.forEach((function(e){t.productId===e.id&&(t.price=e.price)})),e.status.forEach((function(e){t.status===e.value&&(t.statusV=e.name)}))})),e.data=a.list,e.total=a.rowCount,e.closeLoading();case 10:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.getBathSetting(),e.getVipBatchStatus(),t.next=4,e.getVipBatchPro();case 4:e.getOrgs(),e.getProduct(),e.getUsers(""),e.getTableList();case 8:case"end":return t.stop()}}),t)})))()}},m=p,g=r("7a16"),f=(r("141d"),r("2877"));function h(e){this["$style"]=g["default"].locals||g["default"]}var v=Object(f["a"])(m,a,n,!1,h,null,null);t["default"]=v.exports},a833:function(e,t,r){"use strict";r("4de4"),r("4160"),r("a9e3"),r("b680"),r("ac1f"),r("5319"),r("159b"),r("96cf");var a=r("1da1"),n=r("5530"),i=r("2f62");t["a"]={inject:["ApiBasic","ApiResource","ApiBase","ApiProduction","ApiOther","ApiUser","ApiReport","cloneDeep","ApiMenu","dayjs","ApiOrder","ApiCourse"],computed:Object(n["a"])({},Object(i["c"])("course",{dictoryObj:"dictoryObj"})),data:function(){return{loading:!0,total:1,uid:"",userList:[],clickmodal:!1}},methods:{openLoading:function(){this.loading=!0},formatNum:function(e){return e=Number(e),(e.toFixed(2)+"").replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g,"$&,")},closeLoading:function(){this.loading=!1},confirmDelMessage:function(e,t,r){this.$confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(a["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.t0=t,!e.t0){e.next=5;break}return e.next=4,t();case 4:e.t0=e.sent;case 5:a=e.t0,"number"!=typeof a&&r&&r();case 7:case"end":return e.stop()}}),e)}))))},tipMessage:function(e,t){this.$message({showClose:!0,message:e,type:t})},getTreeList:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3?arguments[3]:void 0;if(Array.isArray(e))return e.forEach((function(i){if(i.parentId===r)return a.push(i),i.children=[],t.getTreeList(e,i[n],i.children,n)})),a},flatten:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.forEach((function(e){e.index=r,a.push(e),e.children&&t.flatten(e.children,r+1,a)})),a},filterAllChild:function(){},remoteMethod:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.ApiUser.getSelectUsers(e);case 2:t.userList=r.sent;case 3:case"end":return r.stop()}}),r)})))()},getTarget:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.filter((function(e){if(e.parentId===t)return e}))}}}},bae7:function(e,t,r){e.exports={myInput:"VipBatch_myInput_3eHw2"}},e3aa:function(e,t,r){}}]);